<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
	<title>Nadiia Novakova - Data Engineering</title>
	<link href="https://nnovakova.github.io/categories/data-engineering/atom.xml" rel="self" type="application/atom+xml"/>
  <link href="https://nnovakova.github.io"/>
	<generator uri="https://www.getzola.org/">Zola</generator>
	<updated>2020-10-31T00:00:00+00:00</updated>
	<id>https://nnovakova.github.io/categories/data-engineering/atom.xml</id>
	<entry xml:lang="en">
		<title>PySpark &amp; Plotly</title>
		<published>2020-10-31T00:00:00+00:00</published>
		<updated>2020-10-31T00:00:00+00:00</updated>
		<link href="https://nnovakova.github.io/pyspark-plotly/" type="text/html"/>
		<id>https://nnovakova.github.io/pyspark-plotly/</id>
		<content type="html">&lt;p&gt;Apache Spark is an abstract query engine that allows to process data at scale. Spark provides an API in several languages such as Scala, Java and Python.
Today I would like to show you how to use Python and &lt;a href=&quot;https:&#x2F;&#x2F;databricks.com&#x2F;glossary&#x2F;pyspark&quot;&gt;PySpark&lt;&#x2F;a&gt; to do data analytics in Spark SQL API. 
I will also use Plotly library to visualise processed data.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;datasets&quot;&gt;Datasets&lt;&#x2F;h2&gt;
&lt;p&gt;I am going to use public datasets available at:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;fred.stlouisfed.org&#x2F;series&#x2F;QDEN628BIS&quot;&gt;Residential Property Prices for Germany&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;data.europa.eu&#x2F;euodp&#x2F;en&#x2F;data&#x2F;dataset&#x2F;bank-interest-rates-loans-households&quot;&gt;Bank interest rates - Loans to euro area households&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;The first dataset contains calendar quarter column that we will use to join with second dataset that has the same column. However, we will
need first to do some data preparation to be able to join these two datasets. &lt;&#x2F;p&gt;
&lt;p&gt;Columns we are interested in:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;Prices: quarter and price index. There are no other columns so we take both.&lt;&#x2F;li&gt;
&lt;li&gt;Loans: quarter is at index 0 and interest rate percent is at index 4. We skip all other columns.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;h2 id=&quot;implementation&quot;&gt;Implementation&lt;&#x2F;h2&gt;
&lt;p&gt;We will use such libraries:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;pyspark&lt;&#x2F;li&gt;
&lt;li&gt;plotly&lt;&#x2F;li&gt;
&lt;li&gt;datetime&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;We will need to following imports:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;code&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;pyspark
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;datetime
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;plotly.graph_objs &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;as &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;go
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;datetime &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;datetime
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;plotly.offline &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;plot
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;pyspark.sql &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;SparkSession, SQLContext
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;pyspark.sql.types &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;FloatType, DateType, StructType, StructField
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;from &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;pyspark.sql.functions &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;import &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;to_date, col, date_format
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;&lt;h3 id=&quot;csv-files-into-spark-dataframes&quot;&gt;CSV files into Spark Dataframes&lt;&#x2F;h3&gt;
&lt;p&gt;At the very beginning we need to create few objects for Spark runtime:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;code&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;spark = SparkSession.builder.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;appName&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;LoanVsPrices&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;getOrCreate&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;()
sc = spark.sparkContext
sqlContext = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;SQLContext&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(sc)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;We will use them later in the program code.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;loans&quot;&gt;Loans&lt;&#x2F;h4&gt;
&lt;p&gt;Now we can can read the first dataset for the loans using manually defined schema:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;code&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;loanSchema = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;StructType&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;([
    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;StructField&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;quarterDate&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;DateType&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;True&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;),
    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;StructField&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;percent&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;FloatType&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;True&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;)])

loanDf = spark.sparkContext \
    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;textFile&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;data.csv&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;) \
    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;zipWithIndex&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;() \
    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;filter&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;lambda &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;: x[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;] &amp;gt; &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;5&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;) \
    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;lambda &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;: x[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;].&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;split&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;,&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;)) \
    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;map&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;lambda &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;: (datetime.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;strptime&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(x[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;], &amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;%Y%b&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;float&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(x[&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;4&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;]))) \
    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;toDF&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(loanSchema)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;While reading &lt;code&gt;data.csv&lt;&#x2F;code&gt; file we skip first 5 header rows. Then we split each row by comma and we take only 0 and 4 columns. 
We parse them into &lt;code&gt;Date&lt;&#x2F;code&gt; and &lt;code&gt;Float&lt;&#x2F;code&gt; types respectively.&lt;&#x2F;p&gt;
&lt;h4 id=&quot;prices&quot;&gt;Prices&lt;&#x2F;h4&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;code&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;priceSchema = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;StructType&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;([
    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;StructField&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;quarterDate&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;DateType&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;True&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;),
    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;StructField&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;index2010&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;FloatType&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;True&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;)])

priceDf = spark.read.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;format&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;csv&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;option&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;header&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;True&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;) \
    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;schema&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(priceSchema) \
    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;load&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;QDEN628BIS.csv&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;) \
    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;select&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;to_date&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;quarterDate&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;)).&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;alias&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;quarterDate&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;), &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;col&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;index2010&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;))
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;We use similar schema for reading prices. This time we use standard Spark API to read CVS files, since the prices file is much simpler as it has only one row as header 
and exactly two column that we need.&lt;&#x2F;p&gt;
&lt;h3 id=&quot;debug&quot;&gt;Debug&lt;&#x2F;h3&gt;
&lt;p&gt;We can also print Spark DataFrame schemas and data samples for both datasets.&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;code&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;loanDf.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;show&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;()
loanDf.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;printSchema&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;()

priceDf.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;show&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;()
priceDf.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;printSchema&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;()
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;code&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;+-----------+-------+
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;quarterDate&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;percent&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;+-----------+-------+
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2020-07-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.24&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2020-06-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.28&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2020-05-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.27&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2020-04-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.22&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2020-03-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.18&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2020-02-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.26&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2020-01-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.35&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2019-12-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.27&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2019-11-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.25&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2019-10-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.22&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2019-09-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.24&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2019-08-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.36&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2019-07-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.49&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2019-06-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.61&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2019-05-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.67&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2019-04-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.72&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2019-03-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.79&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2019-02-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.85&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2019-01-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.95&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2018-12-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1.94&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;+-----------+-------+
only&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt; showing top 20 rows

&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;root
 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;--&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt; quarterDate: date (nullable = true)
 |&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;--&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt; percent: float (nullable = true)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;code&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;+-----------+---------+
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;quarterDate&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;index2010&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;+-----------+---------+
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1970-01-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;37.6187&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1970-04-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;39.315&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1970-07-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;39.7142&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1970-10-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;40.2131&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1971-01-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;41.5103&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1971-04-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;43.506&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1971-07-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;44.1047&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1971-10-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;44.2045&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1972-01-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;45.1025&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1972-04-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;46.2002&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1972-07-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;46.6991&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1972-10-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;46.9984&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1973-01-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;47.6969&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1973-04-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;49.8922&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1973-07-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;50.3911&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1973-10-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;50.3911&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1974-01-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;51.4887&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1974-04-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;53.5842&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1974-07-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;54.0831&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
| &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1974-10-01&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|  &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;53.7838&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;+-----------+---------+
only&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt; showing top 20 rows

&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;root
 &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;|&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;--&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt; quarterDate: date (nullable = true)
 |&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;--&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt; index2010: float (nullable = true)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;&lt;h3 id=&quot;join-via-sql&quot;&gt;Join via SQL&lt;&#x2F;h3&gt;
&lt;p&gt;Now we can use Spar SQL to join both dataframes using &lt;code&gt;quarterDate&lt;&#x2F;code&gt; column:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;code&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;priceDf.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;createOrReplaceTempView&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;price&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;)
loanDf.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;createOrReplaceTempView&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;loan&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;)

joined = spark.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;sql&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(
    &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;select p.quarterDate, l.percent, p.index2010 from price p inner join loan l on p.quarterDate = l.quarterDate order by p.quarterDate&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;) \
    .&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;toPandas&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;()
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;First, we define temporary SQL views to be able to reference our dataframes in SQL expressions.
Then we use plain SQL to join both dataframes on &lt;code&gt;quarterDate&lt;&#x2F;code&gt; column and return 3 column as a result.
PySpark is also integrated with Pandas, so that we convert Spark DataFrame to Pandas DataFrame to be able to use it further with Plotly library&lt;&#x2F;p&gt;
&lt;p&gt;We can also preview the joined data via python code &lt;code&gt;print(joined)&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;code&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;   &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;quarterDate&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;  percent   index2010
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;0&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;   2000-01-01     6.71  101.183899
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;1&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;   2000-04-01     6.56  101.403297
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;2&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;   2000-07-01     6.72  101.462097
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;3&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;   2000-10-01     6.70  101.441597
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;4&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;   2001-01-01     6.24  101.421303
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;..&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;         ...      ...         ...
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;76&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;  2019-01-01     1.95  146.000000
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;77&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;  2019-04-01     1.72  149.699997
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;78&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;  2019-07-01     1.49  151.800003
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;79&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;  2019-10-01     1.22  155.500000
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;80&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;  2020-01-01     1.35  155.899994

&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;[81&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt; rows x 3 columns]
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;&lt;h3 id=&quot;visualize-via-plotly&quot;&gt;Visualize via Plotly&lt;&#x2F;h3&gt;
&lt;p&gt;Before we use these joined data in the plot, we need to normalise the numbers, so that will look nicer on the plot. Normalisation also gives ability 
to compare both datasets on the same plot. If we do not normalise then Y axis will be too high, so that it will be hard to compare both scatter plots visually.&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;code&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;def &lt;&#x2F;span&gt;&lt;span style=&quot;color:#8fa1b3;&quot;&gt;normalize&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;df&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;feature_name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;):
    result = df.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;copy&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;()
    max_value = df[feature_name].&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;max&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;()
    min_value = df[feature_name].&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;min&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;()
    result[feature_name] = (
        df[feature_name] - min_value) &#x2F; (max_value - min_value)
    &lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;return &lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;result[feature_name]

percentValues = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;normalize&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(joined, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;percent&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;)
indexValues = &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;normalize&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(joined, &amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;index2010&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;After normalisation we can use Plotly API to make a plot and save it into HTML file:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;code&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;data = [
    go.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Scatter&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;=joined.quarterDate, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;=percentValues,
               &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;% Lo&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;an for House Purchase&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;text&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;=joined.percent),
    go.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Scatter&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;x&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;=joined.quarterDate, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;y&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;=indexValues,
               &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;name&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Residential Property Price (quarterly)&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;text&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;=joined.index2010)
]
fig = go.&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;Figure&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(data, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;layout_title_text&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;=&amp;quot;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;Loan vs. Property Price&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;quot;)
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;plot&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;(fig, &lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;filename&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;=&amp;#39;&lt;&#x2F;span&gt;&lt;span style=&quot;color:#a3be8c;&quot;&gt;plot.html&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;&amp;#39;)
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;If we open &lt;code&gt;plot.html&lt;&#x2F;code&gt; file in the internet browser, then it will look like the following:&lt;&#x2F;p&gt;
&lt;img src=&quot;https:&amp;#x2F;&amp;#x2F;nnovakova.github.io&amp;#x2F;processed_images&amp;#x2F;3564657082ad2e6100.png&quot; &#x2F;&gt;
&lt;h3 id=&quot;data-analyst-summary&quot;&gt;Data Analyst Summary&lt;&#x2F;h3&gt;
&lt;p&gt;Despite the 2008 financial crisis in housing led to price drop, the house purchase loan got increased and still increasing up to 2020 year.
Bank loan interest rate may seem cheap, but regular house prices increases dramatically, so that cheap loan does not help that much. One has to still pay a lot
in order to afford a house or own apartment.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;&#x2F;h2&gt;
&lt;p&gt;We have seen that one can easily use PySpark and its SQL API to process and analyse the data. In real life, we should not use use Spark to analyse such 
small files, this can be done using other Python libraries. However, this example can be used to write another program to analyse peta-byte scale data
using Spark cluster with massive parallelism.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;links&quot;&gt;Links&lt;&#x2F;h2&gt;
&lt;ol&gt;
&lt;li&gt;GitHub Project: &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;nnovakova&#x2F;pyspark-plotly&quot;&gt;https:&#x2F;&#x2F;github.com&#x2F;nnovakova&#x2F;pyspark-plotly&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;plotly.com&#x2F;python&#x2F;&quot;&gt;Plotly Documentation&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;a href=&quot;https:&#x2F;&#x2F;spark.apache.org&#x2F;sql&#x2F;&quot;&gt;Spark SQL Documentation&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
</content>
	</entry>
</feed>
